# â”€â”€â”€ Cloud Build pipeline (single smoke-test) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
logsBucket: gs://grayst0-build-logs                      # âœ… bucket exists

steps:
# â”€â”€ 1. run smoke tests directly in the python:3.11-slim image â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
- id: build-and-test
  name: python:3.11-slim
  entrypoint: bash
  args:
    - -c
    - |
      set -euo pipefail
      echo "ðŸ“¦ installing deps â€¦"
      pip install --quiet --no-cache-dir -r requirements.txt
      echo "ðŸ§ª running smoke tests â€¦"
      python -m pytest -q tests/smoke/
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

timeout: 900s
options:
  logging: CLOUD_LOGGING_ONLY
